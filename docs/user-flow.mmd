%%{init: {'theme': 'dark', 'themeVariables': { 'primaryColor': '#22d3ee', 'primaryTextColor': '#f1f5f9', 'primaryBorderColor': '#0e7490', 'lineColor': '#94a3b8', 'secondaryColor': '#1e293b', 'tertiaryColor': '#334155'}}}%%

flowchart TD
    subgraph Entry["ðŸš€ Entry Point"]
        A[User visits Continuum] --> B{Authenticated?}
    end

    subgraph Auth["ðŸ” Authentication"]
        B -->|No| C[Login Page]
        C --> D{Has Account?}
        D -->|Yes| E[Enter Credentials]
        D -->|No| F[Register Page]
        F --> G[Create Account]
        G --> E
        E --> H{Valid?}
        H -->|No| C
        H -->|Yes| I[Create Session]
        B -->|Yes| I
    end

    subgraph Dashboard["ðŸ  Dashboard"]
        I --> J[Dashboard Home]
        J --> K[View Stats]
        K --> L[ðŸ“ Total Decisions]
        K --> M[ðŸ”— Total Entities]
        K --> N[ðŸ’¬ Capture Sessions]
        K --> O[ðŸ“Š Graph Connections]
        J --> P[Recent Decisions List]
        P --> Q{Click Decision?}
        Q -->|Yes| R[View Decision Details]
    end

    subgraph Navigation["ðŸ“ Main Navigation"]
        J --> NAV{Choose Action}
        NAV -->|Add Knowledge| ADD[ðŸ§  Add Knowledge Page]
        NAV -->|View Graph| GRAPH[ðŸ”— Knowledge Graph]
        NAV -->|Decisions| DEC[ðŸ“‹ Decisions List]
        NAV -->|Search| SEARCH[ðŸ” Search Page]
    end

    subgraph AddKnowledge["ðŸ§  Add Knowledge"]
        ADD --> ADD_CHOICE{Select Method}

        ADD_CHOICE -->|Automatic| IMPORT[ðŸ“‚ Import from Claude Code]
        ADD_CHOICE -->|Interactive| CAPTURE[ðŸ’¬ AI Interview Capture]
        ADD_CHOICE -->|Quick| MANUAL[âœï¸ Manual Entry]

        subgraph Import["ðŸ“‚ Automatic Import"]
            IMPORT --> SCAN[Scan ~/.claude/projects]
            SCAN --> PARSE[Parse JSONL Logs]
            PARSE --> EXTRACT[AI Extract Decisions]
            EXTRACT --> ENTITY_EXT[Extract Entities]
            ENTITY_EXT --> SAVE_IMPORT[Save to Neo4j]
            SAVE_IMPORT --> IMPORT_DONE[âœ… Import Complete]
        end

        subgraph Capture["ðŸ’¬ AI Interview"]
            CAPTURE --> START_SESSION[Start Capture Session]
            START_SESSION --> WELCOME[AI Welcome Message]
            WELCOME --> STAGE_TRIGGER[Stage 1: Trigger]
            STAGE_TRIGGER --> USER_TRIGGER[User describes trigger]
            USER_TRIGGER --> AI_CONTEXT[AI asks for context]
            AI_CONTEXT --> STAGE_CONTEXT[Stage 2: Context]
            STAGE_CONTEXT --> USER_CONTEXT[User provides context]
            USER_CONTEXT --> AI_OPTIONS[AI asks for options]
            AI_OPTIONS --> STAGE_OPTIONS[Stage 3: Options]
            STAGE_OPTIONS --> USER_OPTIONS[User lists options]
            USER_OPTIONS --> AI_DECISION[AI asks for decision]
            AI_DECISION --> STAGE_DECISION[Stage 4: Decision]
            STAGE_DECISION --> USER_DECISION[User states decision]
            USER_DECISION --> AI_RATIONALE[AI asks for rationale]
            AI_RATIONALE --> STAGE_RATIONALE[Stage 5: Rationale]
            STAGE_RATIONALE --> USER_RATIONALE[User explains why]
            USER_RATIONALE --> COMPLETE_DIALOG[Show Complete Dialog]
            COMPLETE_DIALOG --> COMPLETE_CHOICE{User Choice}
            COMPLETE_CHOICE -->|Save| SYNTHESIZE[AI Synthesizes Decision]
            COMPLETE_CHOICE -->|Continue| AI_CONTEXT
            COMPLETE_CHOICE -->|Abandon| J
            SYNTHESIZE --> SAVE_CAPTURE[Save to Neo4j]
            SAVE_CAPTURE --> CAPTURE_DONE[âœ… Capture Complete]
        end

        subgraph Manual["âœï¸ Manual Entry"]
            MANUAL --> REDIRECT_DEC[Redirect to Decisions]
            REDIRECT_DEC --> FORM[Open Add Form]
            FORM --> FILL_TRIGGER[Fill Trigger]
            FILL_TRIGGER --> FILL_CONTEXT[Fill Context]
            FILL_CONTEXT --> FILL_OPTIONS[Fill Options]
            FILL_OPTIONS --> FILL_DECISION[Fill Decision]
            FILL_DECISION --> FILL_RATIONALE[Fill Rationale]
            FILL_RATIONALE --> ADD_ENTITIES[Add Entity Tags]
            ADD_ENTITIES --> SUBMIT[Submit Form]
            SUBMIT --> SAVE_MANUAL[Save to Neo4j]
            SAVE_MANUAL --> MANUAL_DONE[âœ… Manual Entry Complete]
        end
    end

    subgraph KnowledgeGraph["ðŸ”— Knowledge Graph View"]
        GRAPH --> LOAD_GRAPH[Load Graph Data]
        LOAD_GRAPH --> RENDER[Render React Flow]
        RENDER --> DISPLAY_NODES[Display Nodes]
        DISPLAY_NODES --> DECISION_NODES[ðŸ’¡ Decision Nodes]
        DISPLAY_NODES --> ENTITY_NODES[ðŸ”® Entity Nodes]
        DISPLAY_NODES --> EDGES[INVOLVES Relationships]

        RENDER --> GRAPH_ACTIONS{User Actions}
        GRAPH_ACTIONS -->|Click Node| NODE_DETAIL[Show Detail Panel]
        GRAPH_ACTIONS -->|Zoom/Pan| NAVIGATE[Navigate Graph]
        GRAPH_ACTIONS -->|Refresh| LOAD_GRAPH

        NODE_DETAIL --> NODE_TYPE{Node Type?}
        NODE_TYPE -->|Decision| SHOW_DEC_DETAIL[Show Decision Details]
        NODE_TYPE -->|Entity| SHOW_ENT_DETAIL[Show Entity Details]

        SHOW_DEC_DETAIL --> DEC_INFO[Trigger, Context, Decision, Rationale]
        SHOW_ENT_DETAIL --> ENT_INFO[Name, Type]
    end

    subgraph DecisionsList["ðŸ“‹ Decisions Management"]
        DEC --> LOAD_DECISIONS[Load All Decisions]
        LOAD_DECISIONS --> LIST_VIEW[Display Decision Cards]
        LIST_VIEW --> DEC_ACTIONS{User Actions}
        DEC_ACTIONS -->|Click Card| VIEW_DEC[View Full Decision]
        DEC_ACTIONS -->|Add New| FORM
        VIEW_DEC --> FULL_DETAIL[Full Decision Details]
        FULL_DETAIL --> LINKED_ENTITIES[View Linked Entities]
    end

    subgraph SearchFlow["ðŸ” Search"]
        SEARCH --> SEARCH_INPUT[Enter Search Query]
        SEARCH_INPUT --> SEARCH_TYPE{Filter Type?}
        SEARCH_TYPE -->|All| SEARCH_ALL[Search All]
        SEARCH_TYPE -->|Decisions| SEARCH_DEC[Search Decisions]
        SEARCH_TYPE -->|Entities| SEARCH_ENT[Search Entities]

        SEARCH_ALL --> RESULTS[Display Results]
        SEARCH_DEC --> RESULTS
        SEARCH_ENT --> RESULTS

        RESULTS --> RESULT_CLICK{Click Result?}
        RESULT_CLICK -->|Decision| VIEW_DEC
        RESULT_CLICK -->|Entity| ENTITY_VIEW[View Entity]
        ENTITY_VIEW --> RELATED_DECISIONS[Show Related Decisions]
    end

    subgraph UserActions["ðŸ‘¤ User Settings"]
        J --> SETTINGS{Settings}
        SETTINGS -->|Theme| TOGGLE_THEME[Toggle Dark/Light]
        SETTINGS -->|Logout| LOGOUT[End Session]
        LOGOUT --> C
    end

    %% Return paths
    IMPORT_DONE --> J
    CAPTURE_DONE --> J
    MANUAL_DONE --> DEC
    R --> J
    FULL_DETAIL --> DEC
    RELATED_DECISIONS --> SEARCH

    %% Styling
    classDef entry fill:#0e7490,stroke:#22d3ee,stroke-width:2px
    classDef auth fill:#7c3aed,stroke:#a78bfa,stroke-width:2px
    classDef dashboard fill:#1e293b,stroke:#475569,stroke-width:2px
    classDef add fill:#059669,stroke:#34d399,stroke-width:2px
    classDef capture fill:#0891b2,stroke:#22d3ee,stroke-width:2px
    classDef graph fill:#2563eb,stroke:#60a5fa,stroke-width:2px
    classDef search fill:#d97706,stroke:#fbbf24,stroke-width:2px
    classDef complete fill:#16a34a,stroke:#4ade80,stroke-width:2px

    class A,B entry
    class C,D,E,F,G,H,I auth
    class J,K,L,M,N,O,P,Q,R dashboard
    class ADD,ADD_CHOICE add
    class IMPORT,SCAN,PARSE,EXTRACT,ENTITY_EXT,SAVE_IMPORT capture
    class CAPTURE,START_SESSION,WELCOME,STAGE_TRIGGER,USER_TRIGGER,AI_CONTEXT capture
    class GRAPH,LOAD_GRAPH,RENDER,DISPLAY_NODES,DECISION_NODES,ENTITY_NODES,EDGES graph
    class SEARCH,SEARCH_INPUT,SEARCH_TYPE,SEARCH_ALL,SEARCH_DEC,SEARCH_ENT,RESULTS search
    class IMPORT_DONE,CAPTURE_DONE,MANUAL_DONE complete
